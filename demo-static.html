<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IFRS 15 Revenue Recognition - Demo</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .header {
            background-color: #1976d2;
            color: white;
            padding: 16px 24px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.5rem;
            font-weight: 500;
        }
        
        .nav {
            background-color: #1565c0;
            padding: 0 24px;
        }
        
        .nav-buttons {
            display: flex;
            gap: 0;
        }
        
        .nav-btn {
            background: none;
            border: none;
            color: white;
            padding: 12px 20px;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .nav-btn:hover, .nav-btn.active {
            background-color: rgba(255,255,255,0.1);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 32px 24px;
        }
        
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }
        
        .card {
            background: white;
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        
        .card:hover {
            transform: translateY(-2px);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .card-title {
            font-size: 1.1rem;
            font-weight: 500;
            color: #666;
        }
        
        .card-icon {
            color: #1976d2;
            font-size: 32px;
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #1976d2;
            margin-bottom: 8px;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.875rem;
        }
        
        .table {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .table-header {
            background-color: #f8f9fa;
            padding: 16px 24px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .table-title {
            font-size: 1.25rem;
            font-weight: 500;
        }
        
        .table-content {
            padding: 0;
        }
        
        .table-row {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr 1fr 1fr;
            padding: 16px 24px;
            border-bottom: 1px solid #f0f0f0;
            align-items: center;
        }
        
        .table-row:last-child {
            border-bottom: none;
        }
        
        .table-row:nth-child(even) {
            background-color: #fafafa;
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
        }
        
        .status-ativo {
            background-color: #e8f5e8;
            color: #2e7d32;
        }
        
        .status-em_andamento {
            background-color: #fff3e0;
            color: #f57c00;
        }
        
        .currency {
            font-weight: 500;
            color: #1976d2;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .api-status {
            background: white;
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .api-status.healthy {
            border-left: 4px solid #4caf50;
        }
        
        .api-status.error {
            border-left: 4px solid #f44336;
        }
    </style>
</head>
<body>
    <header class="header">
        <h1>
            <span class="material-icons">account_balance</span>
            IFRS 15 Revenue Recognition System
        </h1>
    </header>
    
    <nav class="nav">
        <div class="nav-buttons">
            <button class="nav-btn active" onclick="showPage('dashboard')">
                <span class="material-icons">dashboard</span>
                Dashboard
            </button>
            <button class="nav-btn" onclick="showPage('contracts')">
                <span class="material-icons">description</span>
                Contratos
            </button>
            <button class="nav-btn" onclick="showPage('revenue')">
                <span class="material-icons">monetization_on</span>
                Receita
            </button>
            <button class="nav-btn" onclick="showPage('api')">
                <span class="material-icons">api</span>
                API Status
            </button>
        </div>
    </nav>

    <div class="container">
        <!-- Dashboard Page -->
        <div id="dashboard" class="page active">
            <h2 style="margin-bottom: 24px;">Dashboard IFRS 15</h2>
            
            <div class="stats-grid">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Contratos Ativos</div>
                        <span class="material-icons card-icon">description</span>
                    </div>
                    <div class="stat-number" id="contracts-count">-</div>
                    <div class="stat-label">Total de contratos</div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Receita Reconhecida</div>
                        <span class="material-icons card-icon">monetization_on</span>
                    </div>
                    <div class="stat-number" id="revenue-recognized">-</div>
                    <div class="stat-label">Este período</div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Receita Pendente</div>
                        <span class="material-icons card-icon">schedule</span>
                    </div>
                    <div class="stat-number" id="revenue-pending">-</div>
                    <div class="stat-label">A reconhecer</div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Performance Obligations</div>
                        <span class="material-icons card-icon">assignment</span>
                    </div>
                    <div class="stat-number" id="po-count">-</div>
                    <div class="stat-label">Em andamento</div>
                </div>
            </div>
        </div>

        <!-- Contracts Page -->
        <div id="contracts" class="page">
            <h2 style="margin-bottom: 24px;">Contratos</h2>
            
            <div class="table">
                <div class="table-header">
                    <div class="table-title">Lista de Contratos</div>
                </div>
                <div class="table-content">
                    <div class="table-row" style="font-weight: 500; background-color: #f8f9fa;">
                        <div>ID</div>
                        <div>Cliente</div>
                        <div>Valor</div>
                        <div>Status</div>
                        <div>Data Início</div>
                    </div>
                    <div id="contracts-list" class="loading">
                        Carregando contratos...
                    </div>
                </div>
            </div>
        </div>

        <!-- Revenue Page -->
        <div id="revenue" class="page">
            <h2 style="margin-bottom: 24px;">Receita</h2>
            
            <div class="table">
                <div class="table-header">
                    <div class="table-title">Performance Obligations</div>
                </div>
                <div class="table-content">
                    <div class="table-row" style="font-weight: 500; background-color: #f8f9fa;">
                        <div>Contrato</div>
                        <div>Descrição</div>
                        <div>Valor Alocado</div>
                        <div>Progresso</div>
                        <div>Receita Reconhecida</div>
                    </div>
                    <div id="revenue-list" class="loading">
                        Carregando dados de receita...
                    </div>
                </div>
            </div>
        </div>

        <!-- API Status Page -->
        <div id="api" class="page">
            <h2 style="margin-bottom: 24px;">Status da API</h2>
            
            <div id="api-health" class="api-status">
                <h3>Verificando status da API...</h3>
            </div>
            
            <div class="card">
                <h3>Endpoints Disponíveis</h3>
                <ul style="margin-top: 16px; line-height: 1.6;">
                    <li><strong>GET /api/v1/health</strong> - Status da API</li>
                    <li><strong>GET /api/v1/contracts</strong> - Lista de contratos</li>
                    <li><strong>GET /api/v1/revenue</strong> - Dados de receita</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Navigation
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Remove active from all nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Add active to clicked nav button
            event.target.closest('.nav-btn').classList.add('active');
            
            // Load data for the page
            if (pageId === 'contracts') {
                loadContracts();
            } else if (pageId === 'revenue') {
                loadRevenue();
            } else if (pageId === 'api') {
                checkApiHealth();
            }
        }

        // Format currency
        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(value);
        }

        // Load dashboard data
        async function loadDashboard() {
            try {
                const [contractsRes, revenueRes] = await Promise.all([
                    fetch('/api/v1/contracts'),
                    fetch('/api/v1/revenue')
                ]);
                
                const contractsData = await contractsRes.json();
                const revenueData = await revenueRes.json();
                
                document.getElementById('contracts-count').textContent = contractsData.total || 0;
                document.getElementById('revenue-recognized').textContent = formatCurrency(revenueData.data.totalRecognized || 0);
                document.getElementById('revenue-pending').textContent = formatCurrency(revenueData.data.totalPending || 0);
                document.getElementById('po-count').textContent = revenueData.data.performanceObligations?.length || 0;
            } catch (error) {
                console.error('Erro ao carregar dashboard:', error);
            }
        }

        // Load contracts
        async function loadContracts() {
            try {
                const response = await fetch('/api/v1/contracts');
                const data = await response.json();
                
                const contractsList = document.getElementById('contracts-list');
                contractsList.innerHTML = '';
                contractsList.classList.remove('loading');
                
                data.data.forEach(contract => {
                    const row = document.createElement('div');
                    row.className = 'table-row';
                    row.innerHTML = `
                        <div>${contract.id}</div>
                        <div>${contract.customer}</div>
                        <div class="currency">${formatCurrency(contract.value)}</div>
                        <div><span class="status-badge status-${contract.status}">${contract.status.replace('_', ' ')}</span></div>
                        <div>${new Date(contract.startDate).toLocaleDateString('pt-BR')}</div>
                    `;
                    contractsList.appendChild(row);
                });
            } catch (error) {
                document.getElementById('contracts-list').innerHTML = '<div style="padding: 24px; text-align: center; color: #f44336;">Erro ao carregar contratos</div>';
            }
        }

        // Load revenue data
        async function loadRevenue() {
            try {
                const response = await fetch('/api/v1/revenue');
                const data = await response.json();
                
                const revenueList = document.getElementById('revenue-list');
                revenueList.innerHTML = '';
                revenueList.classList.remove('loading');
                
                data.data.performanceObligations.forEach(po => {
                    const row = document.createElement('div');
                    row.className = 'table-row';
                    row.innerHTML = `
                        <div>${po.contract}</div>
                        <div>${po.description}</div>
                        <div class="currency">${formatCurrency(po.allocatedPrice)}</div>
                        <div>${po.progress}%</div>
                        <div class="currency">${formatCurrency(po.recognizedRevenue)}</div>
                    `;
                    revenueList.appendChild(row);
                });
            } catch (error) {
                document.getElementById('revenue-list').innerHTML = '<div style="padding: 24px; text-align: center; color: #f44336;">Erro ao carregar dados de receita</div>';
            }
        }

        // Check API health
        async function checkApiHealth() {
            try {
                const response = await fetch('/api/v1/health');
                const data = await response.json();
                
                const healthDiv = document.getElementById('api-health');
                healthDiv.className = 'api-status healthy';
                healthDiv.innerHTML = `
                    <h3>✅ API Funcionando</h3>
                    <p><strong>Status:</strong> ${data.status}</p>
                    <p><strong>Versão:</strong> ${data.version}</p>
                    <p><strong>Serviço:</strong> ${data.service}</p>
                    <p><strong>Timestamp:</strong> ${data.timestamp}</p>
                `;
            } catch (error) {
                const healthDiv = document.getElementById('api-health');
                healthDiv.className = 'api-status error';
                healthDiv.innerHTML = `
                    <h3>❌ API Indisponível</h3>
                    <p>Erro: ${error.message}</p>
                `;
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboard();
        });
    </script>
</body>
</html>
