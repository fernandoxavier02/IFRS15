{"ast":null,"code":"import { ActivatedRouteSnapshot, RouterStateSnapshot, Router } from '@angular/router';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nexport var UserRole = /*#__PURE__*/function (UserRole) {\n  UserRole[\"ADMIN_ORG\"] = \"admin_org\";\n  UserRole[\"GERENTE_FINANCEIRO\"] = \"gerente_financeiro\";\n  UserRole[\"CONTABILIDADE\"] = \"contabilidade\";\n  UserRole[\"AUDITOR_EXTERNO\"] = \"auditor_externo\";\n  UserRole[\"CLIENTE\"] = \"cliente\";\n  return UserRole;\n}(UserRole || {});\nexport let RBACGuard = /*#__PURE__*/(() => {\n  class RBACGuard {\n    constructor(authService, router) {\n      this.authService = authService;\n      this.router = router;\n    }\n    canActivate(route, state) {\n      const user = this.authService.getCurrentUser();\n      if (!user) {\n        this.router.navigate(['/login']);\n        return false;\n      }\n      const requiredRoles = route.data['roles'];\n      const requiredPermissions = route.data['permissions'];\n      if (requiredRoles && !this.hasRole(user.role, requiredRoles)) {\n        this.router.navigate(['/unauthorized']);\n        return false;\n      }\n      if (requiredPermissions && !this.hasPermissions(user.role, requiredPermissions)) {\n        this.router.navigate(['/unauthorized']);\n        return false;\n      }\n      return true;\n    }\n    hasRole(userRole, requiredRoles) {\n      return requiredRoles.includes(userRole) || userRole === UserRole.ADMIN_ORG;\n    }\n    hasPermissions(userRole, requiredPermissions) {\n      const rolePermissions = this.getRolePermissions(userRole);\n      if (rolePermissions.includes('*')) return true;\n      return requiredPermissions.every(permission => rolePermissions.includes(permission) || rolePermissions.includes(permission.split(':')[0] + ':*'));\n    }\n    getRolePermissions(role) {\n      const permissions = {\n        [UserRole.ADMIN_ORG]: ['*'],\n        [UserRole.GERENTE_FINANCEIRO]: ['ifrs15:read', 'ifrs15:write', 'policies:read', 'policies:write', 'contracts:read', 'contracts:write', 'revenue:read', 'revenue:write', 'dac:read', 'dac:write', 'reports:read'],\n        [UserRole.CONTABILIDADE]: ['contracts:read', 'contracts:write', 'contracts:reestimate', 'revenue:read', 'revenue:write', 'revenue:reprocess', 'dac:read', 'dac:write', 'invoicing:read', 'invoicing:write', 'reports:read'],\n        [UserRole.AUDITOR_EXTERNO]: ['contracts:read', 'revenue:read', 'dac:read', 'policies:read', 'reports:read', 'snapshots:read', 'audit:read'],\n        [UserRole.CLIENTE]: ['contracts:read:own', 'revenue:read:own', 'invoices:read:own', 'reports:read:own']\n      };\n      return permissions[role] || [];\n    }\n    static {\n      this.ɵfac = function RBACGuard_Factory(t) {\n        return new (t || RBACGuard)(i0.ɵɵinject(AuthService), i0.ɵɵinject(i1.Router));\n      };\n    }\n    static {\n      this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n        token: RBACGuard,\n        factory: RBACGuard.ɵfac,\n        providedIn: 'root'\n      });\n    }\n  }\n  return RBACGuard;\n})();\nexport let AuthService = /*#__PURE__*/(() => {\n  class AuthService {\n    constructor() {\n      this.currentUser = null;\n      this.loadUserFromStorage();\n    }\n    getCurrentUser() {\n      return this.currentUser;\n    }\n    setCurrentUser(user) {\n      this.currentUser = user;\n      localStorage.setItem('current_user', JSON.stringify(user));\n    }\n    logout() {\n      this.currentUser = null;\n      localStorage.removeItem('current_user');\n      localStorage.removeItem('access_token');\n    }\n    loadUserFromStorage() {\n      const userData = localStorage.getItem('current_user');\n      if (userData) {\n        this.currentUser = JSON.parse(userData);\n      }\n    }\n    hasRole(role) {\n      return this.currentUser?.role === role || this.currentUser?.role === UserRole.ADMIN_ORG;\n    }\n    hasPermission(permission) {\n      if (!this.currentUser) return false;\n      const guard = new RBACGuard(this, null);\n      return guard.hasPermissions(this.currentUser.role, [permission]);\n    }\n    static {\n      this.ɵfac = function AuthService_Factory(t) {\n        return new (t || AuthService)();\n      };\n    }\n    static {\n      this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n        token: AuthService,\n        factory: AuthService.ɵfac,\n        providedIn: 'root'\n      });\n    }\n  }\n  return AuthService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}