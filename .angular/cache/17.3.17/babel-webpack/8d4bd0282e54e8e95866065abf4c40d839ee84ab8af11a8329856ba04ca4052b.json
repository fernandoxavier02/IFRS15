{"ast":null,"code":"import { __decorate, __metadata } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { MatTableDataSource } from '@angular/material/table';\nimport { MatDialog, MAT_DIALOG_DATA, MatDialogRef } from '@angular/material/dialog';\nimport { MatSnackBar } from '@angular/material/snack-bar';\nimport { Router } from '@angular/router';\nimport { ClientsApiService } from '../../shared/services/api.service';\nimport { AuthService } from '../../shared/guards/rbac.guard';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/material/dialog\";\nlet ClientsListComponent = class ClientsListComponent {\n  constructor(apiService, authService, dialog, snackBar, router) {\n    this.apiService = apiService;\n    this.authService = authService;\n    this.dialog = dialog;\n    this.snackBar = snackBar;\n    this.router = router;\n    // Remove mat-table related properties\n    // @ViewChild(MatPaginator) paginator!: MatPaginator;\n    // @ViewChild(MatSort) sort!: MatSort;\n    // Remove displayedColumns property since we're not using mat-table anymore\n    // displayedColumns: string[] = [\n    //   'nome', \n    //   'documento', \n    //   'email', \n    //   'status', \n    //   'totalContratos', \n    //   'valorTotal', \n    //   'actions'\n    // ];\n    this.dataSource = new MatTableDataSource();\n    this.loading = false;\n    this.searchTerm = '';\n    this.statusFilter = '';\n    // Pagination properties\n    this.currentPage = 1;\n    this.pageSize = 10;\n    this.totalItems = 0;\n    this.totalPages = 1;\n    this.pageSizeOptions = [5, 10, 25, 50];\n    // Status options\n    this.statusOptions = [{\n      value: '',\n      label: 'Todos'\n    }, {\n      value: 'ativo',\n      label: 'Ativo'\n    }, {\n      value: 'inativo',\n      label: 'Inativo'\n    }, {\n      value: 'suspenso',\n      label: 'Suspenso'\n    }];\n  }\n  ngOnInit() {\n    this.loadClients();\n  }\n  ngAfterViewInit() {\n    // Remove mat-table related initialization\n    // this.dataSource.paginator = this.paginator;\n    // this.dataSource.sort = this.sort;\n  }\n  loadClients() {\n    this.loading = true;\n    const filters = {\n      search: this.searchTerm,\n      status: this.statusFilter\n    };\n    this.apiService.getClients(this.currentPage, this.pageSize, filters).subscribe({\n      next: response => {\n        this.dataSource.data = response.items || [];\n        this.totalItems = response.total || 0;\n        this.totalPages = Math.ceil(this.totalItems / this.pageSize);\n        this.loading = false;\n      },\n      error: error => {\n        console.error('Erro ao carregar clientes:', error);\n        this.snackBar.open('Erro ao carregar clientes!', 'Fechar', {\n          duration: 3000\n        });\n        this.loading = false;\n      }\n    });\n  }\n  applyFilter() {\n    this.currentPage = 1; // Reset to first page when filtering\n    this.loadClients();\n  }\n  clearFilters() {\n    this.searchTerm = '';\n    this.statusFilter = '';\n    this.applyFilter();\n  }\n  // Pagination methods\n  get Math() {\n    return Math;\n  }\n  previousPage() {\n    if (this.currentPage > 1) {\n      this.currentPage--;\n      this.loadClients();\n    }\n  }\n  nextPage() {\n    if (this.currentPage < this.totalPages) {\n      this.currentPage++;\n      this.loadClients();\n    }\n  }\n  onPageChange() {\n    this.loadClients();\n  }\n  onStatusFilterChange() {\n    this.currentPage = 1; // Reset to first page when filtering\n    this.loadClients();\n  }\n  // Actions\n  canCreate() {\n    return this.authService.hasPermission('clients:create');\n  }\n  canEdit() {\n    return this.authService.hasPermission('clients:update');\n  }\n  canDelete() {\n    return this.authService.hasPermission('clients:delete');\n  }\n  canView() {\n    return this.authService.hasPermission('clients:read');\n  }\n  createClient() {\n    this.router.navigate(['/clients/new']);\n  }\n  editClient(client) {\n    this.router.navigate(['/clients', client.id, 'edit']);\n  }\n  viewClient(client) {\n    this.router.navigate(['/clients', client.id]);\n  }\n  deleteClient(client) {\n    const dialogRef = this.dialog.open(ConfirmDialogComponent, {\n      width: '400px',\n      data: {\n        title: 'Confirmar Exclusão',\n        message: `Tem certeza que deseja excluir o cliente \"${client.nome}\"?`,\n        confirmText: 'Excluir',\n        cancelText: 'Cancelar'\n      }\n    });\n    dialogRef.afterClosed().subscribe(result => {\n      if (result) {\n        // Simulating API call - in a real app, this would call the API\n        const index = this.dataSource.data.findIndex(c => c.id === client.id);\n        if (index > -1) {\n          const newData = [...this.dataSource.data];\n          newData.splice(index, 1);\n          this.dataSource.data = newData;\n          this.snackBar.open('Cliente excluído com sucesso!', 'Fechar', {\n            duration: 3000\n          });\n        }\n      }\n    });\n  }\n  toggleClientStatus(client) {\n    const newStatus = client.status === 'ativo' ? 'inativo' : 'ativo';\n    // Simulating API call - in a real app, this would call the API\n    client.status = newStatus;\n    this.snackBar.open(`Status do cliente alterado para ${newStatus}!`, 'Fechar', {\n      duration: 3000\n    });\n  }\n  viewContracts(client) {\n    this.router.navigate(['/contracts'], {\n      queryParams: {\n        clientId: client.id\n      }\n    });\n  }\n  // Utility methods\n  getStatusColor(status) {\n    switch (status) {\n      case 'ativo':\n        return 'primary';\n      case 'inativo':\n        return 'accent';\n      case 'suspenso':\n        return 'warn';\n      default:\n        return '';\n    }\n  }\n  getStatusIcon(status) {\n    switch (status) {\n      case 'ativo':\n        return 'check_circle';\n      case 'inativo':\n        return 'radio_button_unchecked';\n      case 'suspenso':\n        return 'block';\n      default:\n        return 'help';\n    }\n  }\n  exportClients() {\n    this.loading = true;\n    this.apiService.exportClients().subscribe({\n      next: blob => {\n        const url = window.URL.createObjectURL(blob);\n        const link = document.createElement('a');\n        link.href = url;\n        link.download = `clientes_${new Date().toISOString().split('T')[0]}.xlsx`;\n        link.click();\n        window.URL.revokeObjectURL(url);\n        this.loading = false;\n        this.snackBar.open('Relatório exportado com sucesso!', 'Fechar', {\n          duration: 3000\n        });\n      },\n      error: error => {\n        // Fallback to CSV export if API fails\n        const exportData = this.dataSource.filteredData.map(client => ({\n          Nome: client.nome,\n          Documento: client.documento,\n          Email: client.email,\n          Telefone: client.telefone,\n          Status: client.status,\n          'Total Contratos': client.totalContratos,\n          'Valor Total': client.valorTotal\n        }));\n        const csvContent = this.convertToCSV(exportData);\n        const blob = new Blob([csvContent], {\n          type: 'text/csv;charset=utf-8;'\n        });\n        const url = window.URL.createObjectURL(blob);\n        const link = document.createElement('a');\n        link.href = url;\n        link.download = `clientes_${new Date().toISOString().split('T')[0]}.csv`;\n        link.click();\n        window.URL.revokeObjectURL(url);\n        this.loading = false;\n        this.snackBar.open('Relatório exportado como CSV (fallback)', 'Fechar', {\n          duration: 3000\n        });\n      }\n    });\n  }\n  convertToCSV(data) {\n    if (!data || data.length === 0) return '';\n    const headers = Object.keys(data[0]);\n    const csvRows = [headers.join(','), ...data.map(row => headers.map(header => `\"${row[header] || ''}\"`).join(','))];\n    return csvRows.join('\\n');\n  }\n};\nClientsListComponent = __decorate([Component({\n  selector: 'app-clients-list',\n  templateUrl: './clients-list.component.html',\n  styleUrls: ['./clients-list.component.scss'],\n  standalone: false\n}), __metadata(\"design:paramtypes\", [ClientsApiService, AuthService, MatDialog, MatSnackBar, Router])], ClientsListComponent);\nexport { ClientsListComponent };\n// Confirm Dialog Component (inline for simplicity)\nexport let ConfirmDialogComponent = /*#__PURE__*/(() => {\n  class ConfirmDialogComponent {\n    constructor(dialogRef, data) {\n      this.dialogRef = dialogRef;\n      this.data = data;\n    }\n    onConfirm() {\n      this.dialogRef.close(true);\n    }\n    onCancel() {\n      this.dialogRef.close(false);\n    }\n    static {\n      this.ɵfac = function ConfirmDialogComponent_Factory(t) {\n        return new (t || ConfirmDialogComponent)(i0.ɵɵdirectiveInject(i1.MatDialogRef), i0.ɵɵdirectiveInject(MAT_DIALOG_DATA));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: ConfirmDialogComponent,\n        selectors: [[\"app-confirm-dialog\"]],\n        decls: 10,\n        vars: 4,\n        consts: [[\"mat-dialog-title\", \"\"], [1, \"dialog-content\"], [\"align\", \"end\", 1, \"dialog-actions\"], [\"mat-button\", \"\", 3, \"click\"], [\"mat-raised-button\", \"\", \"color\", \"warn\", 3, \"click\"]],\n        template: function ConfirmDialogComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"h2\", 0);\n            i0.ɵɵtext(1);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(2, \"div\", 1)(3, \"p\");\n            i0.ɵɵtext(4);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(5, \"div\", 2)(6, \"button\", 3);\n            i0.ɵɵlistener(\"click\", function ConfirmDialogComponent_Template_button_click_6_listener() {\n              return ctx.onCancel();\n            });\n            i0.ɵɵtext(7);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(8, \"button\", 4);\n            i0.ɵɵlistener(\"click\", function ConfirmDialogComponent_Template_button_click_8_listener() {\n              return ctx.onConfirm();\n            });\n            i0.ɵɵtext(9);\n            i0.ɵɵelementEnd()();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance();\n            i0.ɵɵtextInterpolate(ctx.data.title);\n            i0.ɵɵadvance(3);\n            i0.ɵɵtextInterpolate(ctx.data.message);\n            i0.ɵɵadvance(3);\n            i0.ɵɵtextInterpolate(ctx.data.cancelText);\n            i0.ɵɵadvance(2);\n            i0.ɵɵtextInterpolate(ctx.data.confirmText);\n          }\n        },\n        encapsulation: 2\n      });\n    }\n  }\n  return ConfirmDialogComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}